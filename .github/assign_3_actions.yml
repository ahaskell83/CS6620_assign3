name: CI/CD Pipeline

on:
  workflow_dispatch:
    #future- add option to only test certain code
  push:
    branches: [ "main" ]

jobs:
  docker:
    timeout-minutes: 15
    runs-on: unbuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Run compose
      run: docker compose -f "docker-compose.yml" up -d --build

    - name: Initialize the Terraform Configuration
      run: terraform init

    - name: Run Terraform Plan
      run: terraform plan

    - name: Run Terraform Apply
      run: terraform apply --auto-approve

    - name: Test with Pytest
      run: |
        python -m pytest